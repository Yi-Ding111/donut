# DoNut - EncoderDecoder

The encoder extracts features from an input, and the decoder uses the features to produce an output.









## [Swin Transformer (Donut Vision Encoder)](https://arxiv.org/abs/2103.14030)

Encode the image into a tensor of embeddings (of shape batch_size, seq_len, hidden_size).









## BART (Donut Text Decoder)

decoder autoregressively generates text, conditioned on the encoding of the encoder.





### max_length Decoder

The max_length of the decoder is to control <u>the maximum number of steps that this loop can last</u>.
If the decoder has not generated the <end> tag after reaching the max_length step, then the loop will be forced to end, and the current incomplete output sequence will be used as the **final output result**.



1. Prevent the decoder from entering an infinite loop and cannot be terminated in some cases. max_length can ensure that the generation of the output sequence will end after the specified number of steps.

   

2. Help control GPU/TPU memory usage. Longer sequences will take up more memory, and max_length can avoid memory overflow caused by ultra-long sequences.

   

**Setting an appropriate max_length is one of the important considerations in model design. Too long may cause the above problems, and too short may cause the length of the sequence generated by the model to be insufficient, affecting performance.**